<!DOCTYPE html>
{% assign current_brand = site.brand | default: 'loom' %}
<html lang="en" data-brand="{{ current_brand }}" data-theme="{{ site.brand_default_theme | default: 'light' }}">
<head>
  {% include head.html %}
</head>
<body class="
  {{ page.layout }}-template
  {% for cat in page.categories %} tag-{{ cat | slugify }}{% endfor %}
  {% if page.math %} tag-hash-math{% endif %}
  {% if page.diagram %} tag-hash-diagram{% endif %}
  {% if page.viz %} tag-hash-viz{% endif %}
  {% if page.geo %} tag-hash-geo{% endif %}
  {% if page.leaflet %} tag-hash-leaflet{% endif %}
  {% if page.d3 %} tag-hash-d3{% endif %}
  {% if page.story %} tag-hash-story{% endif %}
">

<a href="#main-content" class="skip-link">Skip to content</a>

{% include header.html %}

<div id="main-content">
  {{ content }}
</div>

{% include footer.html %}

<!-- Alpine.js bundle -->
<script type="module" src="{{ '/assets/dist/main.js' | relative_url }}"></script>

<!-- Visualization runtime — detects and loads CDN libraries dynamically -->
<script type="module" src="{{ '/assets/js/core.js' | relative_url }}"></script>

<!-- Search overlay — event-driven: nav button $dispatches 'search:open' -->
<div
  x-data="search"
  x-init="init()"
  @search:open.window="open()"
>
  <div
    class="search-overlay"
    x-show="isOpen"
    x-transition:enter="transition ease-out duration-150"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-100"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    @click.self="close()"
    style="display: none;"
    role="dialog"
    aria-modal="true"
    aria-label="Search"
  >
    <div class="search-panel">
      <div class="search-input-wrap">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input
          class="search-input"
          type="search"
          placeholder="Search posts…"
          x-model="query"
          x-ref="input"
          @input.debounce.300ms="runSearch()"
          @keydown.escape="close()"
          autocomplete="off"
          spellcheck="false"
          aria-label="Search query"
        >
        <kbd class="search-esc" aria-hidden="true">ESC</kbd>
      </div>

      <div class="search-results" x-show="query.trim().length > 0">
        <div class="search-status" x-show="loading" aria-live="polite">Searching…</div>
        <div class="search-status" x-show="!loading && results.length === 0" aria-live="polite">
          No results for "<span x-text="query"></span>"
        </div>
        <ul class="search-result-list" x-show="!loading && results.length > 0" role="list">
          <template x-for="result in results" :key="result.url">
            <li>
              <a :href="result.url" class="search-result-item" @click="close()">
                <div class="search-result-title" x-text="result.meta?.title || result.url"></div>
                <div class="search-result-excerpt" x-html="result.excerpt"></div>
              </a>
            </li>
          </template>
        </ul>
      </div>
    </div>
  </div>
</div>

</body>
</html>
